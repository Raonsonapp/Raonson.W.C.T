name: Raonson

on:
  push:
    anches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'

      - name: Force Clean & Recreate
        run: |
          # 1. Тоза кардани ҳама файлҳои шубҳанок
          rm -rf android ios web macos linux windows
          rm -f pubspec.lock
          
          # 2. Сохтани файли pubspec.yaml-и тоза (агар дар он хато бошад)
          cat <<EOF > pubspec.yaml
          name: raonson
          description: "Raonson mobile app"
          publish_to: 'none'
          version: 1.0.0+1
          environment:
            sdk: '>=3.2.0 <4.0.0'
          dependencies:
            flutter:
              sdk: flutter
            cupertino_icons: ^1.0.2
          dev_dependencies:
            flutter_test:
              sdk: flutter
            flutter_lints: ^3.0.0
          flutter:
            uses-material-design: true
          EOF

          # 3. Сохтани лоиҳаи нав дар болои коди мавҷуда
          flutter create . --platforms android --package-name com.raonson.app --force
          
          # 4. Насб кардани пакетҳо
          flutter pub get
          
          # 5. Сохтани APK
          flutter build apk --debug
